# Phase 2: æ ¸å¿ƒåŠŸèƒ½å®æ–½

## ç›®æ ‡
æ„å»º agent è·¯ç”±ã€ä»»åŠ¡åˆ†å‘ã€ä¸Šä¸‹æ–‡ä¼ é€’å’Œç›‘æ§èƒ½åŠ›ï¼Œä½¿å¤š agent åä½œç³»ç»Ÿå¯è¿è¡Œã€‚

---

## ğŸ—ï¸ ç»„ä»¶æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    OpenClaw Agent Runtime                    â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           Agent Router (èƒ½åŠ›åŒ¹é…)                      â”‚  â”‚
â”‚  â”‚   - åˆ†æä»»åŠ¡éœ€æ±‚                                      â”‚  â”‚
â”‚  â”‚   - åŒ¹é…æœ€ä½³ agent                                    â”‚  â”‚
â”‚  â”‚   - å¹¶è¡Œ/é¡ºåºè°ƒåº¦å†³ç­–                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â†“                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         Task Dispatcher (ä»»åŠ¡åˆ†å‘)                     â”‚  â”‚
â”‚  â”‚   - å• agent ä»»åŠ¡                                     â”‚  â”‚
â”‚  â”‚   - å¹¶è¡ŒæŠ•ç¥¨ (Agent Forest)                          â”‚  â”‚
â”‚  â”‚   - é¡ºåºé“¾                                            â”‚  â”‚
â”‚  â”‚   - å±‚çº§æ¨¡å¼ (GM Agent)                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â†“                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚       Context Manager (ä¸Šä¸‹æ–‡ä¼ é€’)                     â”‚  â”‚
â”‚  â”‚   - ä¸Šä¸‹æ–‡æ‰“åŒ…/è§£åŒ…                                   â”‚  â”‚
â”‚  â”‚   - çŠ¶æ€ä¼ é€’                                         â”‚  â”‚
â”‚  â”‚   - ç»“æœèšåˆ                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â†“                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚        Agent Monitor (ç›‘æ§å’Œæ—¥å¿—)                     â”‚  â”‚
â”‚  â”‚   - æ‰§è¡Œæ—¥å¿—                                         â”‚  â”‚
â”‚  â”‚   - æ€§èƒ½æŒ‡æ ‡                                         â”‚  â”‚
â”‚  â”‚   - è´¨é‡è¯„åˆ†                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ ç»„ä»¶æ¸…å•

### 1. Agent Router (`agent-router.js`)
**èŒè´£**: å°†ä»»åŠ¡è·¯ç”±åˆ°æœ€åˆé€‚çš„ agent

**åŠŸèƒ½**:
- ä»»åŠ¡åˆ†æï¼ˆæå–éœ€æ±‚å…³é”®è¯ï¼‰
- Agent èƒ½åŠ›åŒ¹é…è¯„åˆ†
- å¤š agent å€™é€‰æ’åº
- åä½œæ¨¡å¼å†³ç­–ï¼ˆå• agent / å¹¶è¡Œ / é¡ºåºï¼‰

**API**:
```javascript
await router.route(task, options)
// è¿”å›: { mode, agents, strategy }
```

---

### 2. Task Dispatcher (`task-dispatcher.js`)
**èŒè´£**: æ‰§è¡Œä»»åŠ¡åˆ†å‘å’Œç¼–æ’

**åŠŸèƒ½**:
- å• agent ä»»åŠ¡æ‰§è¡Œ
- å¹¶è¡ŒæŠ•ç¥¨æ‰§è¡Œï¼ˆæ”¶é›†å¤šä¸ª agent ç»“æœå¹¶æŠ•ç¥¨ï¼‰
- é¡ºåºé“¾æ‰§è¡Œï¼ˆä¸€ä¸ª agent è¾“å‡ºä¼ ç»™ä¸‹ä¸€ä¸ªï¼‰
- å±‚çº§æ¨¡å¼æ‰§è¡Œï¼ˆGM Agent åè°ƒï¼‰
- è¶…æ—¶å’Œé‡è¯•æœºåˆ¶

**API**:
```javascript
await dispatcher.execute(task, routingPlan)
// è¿”å›: { result, quality, metrics }
```

---

### 3. Context Manager (`context-manager.js`)
**èŒè´£**: ç®¡ç†ä¸Šä¸‹æ–‡ä¼ é€’å’ŒçŠ¶æ€

**åŠŸèƒ½**:
- ä¸Šä¸‹æ–‡æ‰“åŒ…ï¼ˆä»»åŠ¡ + å†å² + çŠ¶æ€ï¼‰
- ä¸Šä¸‹æ–‡è§£åŒ…å’ŒéªŒè¯
- çŠ¶æ€æ›´æ–°å’ŒæŒä¹…åŒ–
- ç»“æœèšåˆï¼ˆæŠ•ç¥¨ã€åˆå¹¶ã€æ€»ç»“ï¼‰

**API**:
```javascript
await contextManager.pack(task, history, state)
await contextManager.unpack(context)
await contextManager.aggregate(results, mode)
```

---

### 4. Agent Monitor (`agent-monitor.js`)
**èŒè´£**: ç›‘æ§ã€æ—¥å¿—å’ŒæŒ‡æ ‡

**åŠŸèƒ½**:
- æ‰§è¡Œæ—¥å¿—è®°å½•
- æ€§èƒ½æŒ‡æ ‡æ”¶é›†ï¼ˆå»¶è¿Ÿã€token ä½¿ç”¨ï¼‰
- è´¨é‡è¯„åˆ†è®¡ç®—
- å¥åº·æ£€æŸ¥

**API**:
```javascript
monitor.logExecution(agentId, task, result, metrics)
monitor.getMetrics(agentId)
monitor.getHealthStatus()
```

---

## ğŸ¯ åä½œæ¨¡å¼

### æ¨¡å¼ 1: å• Agent
```javascript
Task â†’ Router â†’ [DevAgent] â†’ Result
```

**è§¦å‘æ¡ä»¶**: ç®€å•ä»»åŠ¡ï¼Œå•ä¸€é¢†åŸŸ

---

### æ¨¡å¼ 2: å¹¶è¡ŒæŠ•ç¥¨ (Agent Forest)
```javascript
      â”Œâ”€â”€â†’ DevAgent â”€â”€â”€â”
Task â†’ â”œâ”€â”€â†’ LegalAgent â”€â”€â”¤ â†’ Vote â†’ Result
      â””â”€â”€â†’ Agent N â”€â”€â”€â”€â”€â”˜
```

**è§¦å‘æ¡ä»¶**: é«˜é£é™©ä»»åŠ¡ï¼Œéœ€è¦å¤šè§’åº¦éªŒè¯

---

### æ¨¡å¼ 3: é¡ºåºé“¾
```javascript
Task â†’ ResearchAgent â†’ DevAgent â†’ ReviewAgent â†’ Result
```

**è§¦å‘æ¡ä»¶**: å¤šæ­¥éª¤æµæ°´çº¿ä»»åŠ¡

---

### æ¨¡å¼ 4: å±‚çº§æ¨¡å¼ (GM Agent)
```javascript
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  GM Agent   â”‚
         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â†“          â†“          â†“
  DevAgent  LegalAgent  ResearchAgent
```

**è§¦å‘æ¡ä»¶**: å¤æ‚é¡¹ç›®ï¼Œéœ€è¦æ€»åè°ƒ

---

## ğŸ“Š æ‰§è¡Œæµç¨‹

```
1. User Request
   â†“
2. Agent Router
   - åˆ†æä»»åŠ¡
   - åŒ¹é… agents
   - é€‰æ‹©åä½œæ¨¡å¼
   â†“
3. Task Dispatcher
   - åˆ†å‘ä»»åŠ¡
   - åè°ƒæ‰§è¡Œ
   - å¤„ç†é‡è¯•
   â†“
4. Context Manager
   - ä¼ é€’ä¸Šä¸‹æ–‡
   - èšåˆç»“æœ
   â†“
5. Agent Monitor
   - è®°å½•æ—¥å¿—
   - æ”¶é›†æŒ‡æ ‡
   - è¯„ä¼°è´¨é‡
   â†“
6. Result â†’ User
```

---

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•
- Router: ä»»åŠ¡åˆ†æå’ŒåŒ¹é…é€»è¾‘
- Dispatcher: å„åä½œæ¨¡å¼æ‰§è¡Œ
- Context Manager: ä¸Šä¸‹æ–‡æ‰“åŒ…/è§£åŒ…
- Monitor: æ—¥å¿—å’ŒæŒ‡æ ‡æ”¶é›†

### é›†æˆæµ‹è¯•
- ç«¯åˆ°ç«¯ä»»åŠ¡æ‰§è¡Œ
- åä½œæ¨¡å¼åˆ‡æ¢
- é”™è¯¯å¤„ç†å’Œé‡è¯•

---

## ğŸ“ å®æ–½ä¼˜å…ˆçº§

| ç»„ä»¶ | å¤æ‚åº¦ | ä¼˜å…ˆçº§ | é¢„è®¡æ—¶é—´ |
|------|--------|--------|----------|
| Agent Router | ä¸­ | P0 | 1h |
| Task Dispatcher | é«˜ | P0 | 2h |
| Context Manager | ä¸­ | P1 | 1h |
| Agent Monitor | ä½ | P2 | 0.5h |
| æµ‹è¯•å’Œæ–‡æ¡£ | - | - | 1h |

**æ€»è®¡**: ~5.5 å°æ—¶

---

## ğŸ”— ä¾èµ–

- `agent-factory.js` - Agent åŠ è½½å’Œå®ä¾‹åŒ–
- `registry.json` - Agent æ³¨å†Œè¡¨
- `agent-schema.json` - éªŒè¯è§„åˆ™

---

**ç‰ˆæœ¬**: 1.0.0
**çŠ¶æ€**: ğŸš§ è¿›è¡Œä¸­
**å¼€å§‹æ—¶é—´**: 2026-02-11
