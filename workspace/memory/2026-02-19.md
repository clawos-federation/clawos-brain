# 2026-02-19 Session Notes

## OpenClaw System Optimization & Audit

### Provider Cleanup
- **Removed OpenCode provider** - User confirmed removal
  - Deleted `models.providers.opencode` from openclaw.json
  - Cleaned up all `opencode/*` references from agent defaults
  - Removed `opencode:default` auth profile from all agents
  - Reason: Not used by any agent, overrides built-in catalog

### Memory Embedding Configuration
- **Configured Voyage AI** for memory embeddings
  - Added `voyage:default` auth profile with API key
  - Memory system now recognizes Voyage as embedding provider
  - Using `voyage-4-large` model
  - Status: Rate limited (3 RPM / 10K TPM) on free tier
  - Action needed: Add payment method at dashboard.voyageai.com for full rate limits

### Security Audit & Fixes
- **Fixed critical file permissions** (644 → 600):
  - `~/.openclaw/openclaw.json`
  - All `~/.openclaw/agents/*/agent/auth-profiles.json`
- **Remaining warnings** (user declined to fix for now):
  - `gateway.trustedProxies` not configured (only needed for reverse proxy)
  - iMessage DM session isolation not configured (`session.dmScope`)
  - Current: Multiple DMs share main session context

### Current System State
- **Providers**: Only `zai` (GLM models)
- **Channels**: iMessage enabled, Feishu enabled but not configured
- **Plugins loaded**: device-pair, google-antigravity-auth, google-gemini-cli-auth, imessage, memory-core, phone-control, talk-voice
- **Gateway**: Local mode, loopback only
- **Agents**: gm, devagent, testagent, legalagent, researchagent, henry
- **Memory**: Enabled but not fully indexed (rate limited)

### User Preferences
- Prefers iMessage channel only
- Not interested in DM session isolation for now
- Wants to understand CLI vs channel mode differences

---

## Git Clone Task
- User requested clone of `https://github.com/jajabong/openclaw-system.git`
- Cloned to `/Users/dongshenglu/openclaw-system/workspace/openclaw-system`

---

## 6.6.1 → 7.7 渐进迁移启动（30分钟低风险版）
- 用户确认执行“渐进迁移”，不做一次性全量升级
- 已完成基线检查：`openclaw status`
  - Gateway running
  - Security: 0 critical / 1 warn (`trustedProxies`)
  - iMessage channel: OK
- 已落地迁移清单文档：
  - `/Users/dongshenglu/openclaw-system/workspace/MIGRATION_6.6.1_TO_7.7_30MIN.md`
- 本轮策略：
  - 引入 Iron Gate（结果证据化）
  - 引入调度优先（复杂任务先 GM/子 Agent）
  - 维持 provider 稳态，不回滚 OpenCode
  - 安全项与 memory 限流问题进入长期待办
- 下一步：按 Go/No-Go 门槛进入 5% 灰度验证

### 灰度已启动（执行）
- 用户指令："开始灰度"
- 已创建灰度状态文件：`/Users/dongshenglu/openclaw-system/workspace/MIGRATION_ROLLOUT_STATE.json`
  - 分流目标：6.6.1=95%，7.7=5%（canary_started）
  - 启动时间：2026-02-19 09:58 (Asia/Shanghai)
- 已创建 30 分钟检查提醒（cron）
  - Job ID: `305624bb-cc25-4b91-8608-b41d43bd042b`
  - 检查点时间：2026-02-19 10:28 (Asia/Shanghai)
- 已更新迁移主清单：`MIGRATION_6.6.1_TO_7.7_30MIN.md`

### 全自动灰度控制已接入
- 用户指令："全自动实施吧"
- 新增自动控制脚本：`/Users/dongshenglu/openclaw-system/workspace/scripts/auto_rollout.py`
  - 每次执行自动判断：放量 / 保持 / 回滚
  - 回滚触发：错误率、P95劣化、安全告警、一致性异常
- 新增指标输入文件：`/Users/dongshenglu/openclaw-system/workspace/MIGRATION_METRICS.json`
  - 为防误放量，`source=default-template` 时不会自动升档
- 已创建自动控制 cron（每30分钟）：
  - Job ID: `db9d1961-f9dc-47c6-8110-dbb485367b84`
  - sessionTarget=isolated, payload=agentTurn
- 已手动触发一次自动控制任务进行联调（force run）

### 7.7 角色宪章嵌入默认行为（Henry/GM）
- 用户要求 GM 全面检查 Henry 与 GM 的定位、特质、协作并实施优化
- 已完成分析报告：`/Users/dongshenglu/openclaw-system/workspace/GM_REVIEW_HENRY_GM_7.7.md`
- 已固化系统默认行为文档：`/Users/dongshenglu/openclaw-system/workspace/CHARTER_7.7_ROLES.md`
- 已嵌入 AGENTS 默认规则：
  - `AGENTS.md` 标题升级为 Orchestration 7.7
  - 执行规则改为“默认 GM 主路由，Henry 以沟通为主”
  - 升级流程图改为“Henry 接待 -> GM 评估编排 -> 专业 Agent -> GM 验收 -> Henry 回传"

### Babel 暂停点（待用户出差回来继续）
- 用户确认暂缓真实站点 E2E（需本机Chrome Relay附加标签页）
- 当前已完成：
  - 二次注入状态机主链路实现与测试
  - ChatGPT/Claude/Gemini 适配器契约测试
  - E2E 模拟（成功/失败路径）
- 用户要求转入 AIchemist 头脑风暴
