# 临时 Agent 协议

## 概述

定义临时 agent 的生命周期管理、权限控制和审批流程。

---

## 生命周期

```
请求 → 审批 → 创建 → 执行 → 清理 → 归档
```

### 阶段详情

| 阶段 | 执行者 | 时限 | 产出 |
|------|--------|------|------|
| 请求 | 任意 PM | - | 请求文档 |
| 审批 | GM + Human | 24h | 审批记录 |
| 创建 | Platform PM | 5min | 临时会话 |
| 执行 | 临时 Agent | ≤8h | 任务结果 |
| 清理 | Platform PM | 1h | 清理确认 |
| 归档 | Platform PM | - | 审计日志 |

---

## 权限限制

### 允许继承的权限
临时 agent 只能继承基础模板已有的权限。

### 禁止的权限
- 修改 openclaw.json
- 创建/修改其他 agent
- 访问 credentials/
- 执行 git push --force

### 新增权限
任何基础模板中没有的权限都需要 Human 审批。

---

## 资源限制

| 资源 | 限制 |
|------|------|
| 最大生命周期 | 8 小时 |
| 最大并发临时 agent | 3 个 |
| 最大会话数 | 1 个 |
| 存储空间 | 100MB |

---

## 审批流程

```
PM 请求
    ↓
GM 评估（权限、必要性、风险评估）
    ↓
需要新权限？
    ├── 否 → GM 批准 → 创建
    └── 是 → Human 审批 → 创建
```

### GM 评估内容
1. 任务是否真的需要临时 agent？
2. 是否可以用现有 agent 完成？
3. 权限请求是否合理？
4. 时间限制是否适当？

---

## 自动清理

### 触发条件
- 生命周期结束
- 任务完成
- 错误终止
- 手动终止

### 清理操作
1. 销毁会话
2. 删除临时文件
3. 保留日志到 blackboard
4. 更新审计记录

### 清理时限
- 正常结束：立即清理
- 异常结束：24 小时后清理

---

## 监控和告警

### 监控指标
- 存活时间
- 资源使用
- 错误率

### 告警规则
- 超过 6 小时：警告
- 超过 8 小时：强制终止
- 资源超限：警告
- 错误率过高：通知 GM

---

## 审计要求

所有临时 agent 操作必须记录：
- 请求者
- 审批者
- 创建时间
- 销毁时间
- 执行结果
- 资源使用
