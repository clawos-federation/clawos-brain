# 自我改进协议

## 概述

定义 agent 自我改进的四级审批流程、监控机制和回滚策略。

---

## 核心原则

> **Agent 可以 PROPOSE，但只有 Human 可以 APPROVE**

---

## 四级审批流程

```
Agent 提案
    ↓
┌─────────────────────────────────────┐
│ 1. Validator（质量检查）            │
│    - 文档完整性                     │
│    - 格式合规性                     │
│    - 风险评估完整性                 │
│    时限: 24h                        │
└─────────────────────────────────────┘
    ↓
┌─────────────────────────────────────┐
│ 2. Platform PM（安全评估）          │
│    - 权限变更评估                   │
│    - 系统兼容性                     │
│    - 资源影响                       │
│    时限: 48h                        │
└─────────────────────────────────────┘
    ↓
┌─────────────────────────────────────┐
│ 3. GM（架构评估）                   │
│    - 设计质量                       │
│    - 可维护性                       │
│    - 系统影响                       │
│    时限: 48h                        │
└─────────────────────────────────────┘
    ↓
┌─────────────────────────────────────┐
│ 4. Human（最终决策）                │
│    - 风险接受                       │
│    - 业务影响评估                   │
│    - 最终批准/拒绝                  │
│    时限: 72h                        │
└─────────────────────────────────────┘
    ↓
部署 + 监控
```

---

## 禁止修改的内容

以下内容**绝对禁止**通过自我改进修改：

| 内容 | 原因 |
|------|------|
| `openclaw.json` | Agent 定义和权限 |
| `SOUL.md` | Agent 核心身份 |
| `IDENTITY.md` | 系统身份配置 |
| `credentials/` | 敏感凭证 |
| `protocols/security-*.md` | 安全协议 |
| 审批流程 | 不能绕过自己 |

---

## 监控机制

### 24小时监控窗口

所有自我改进部署后必须监控 24 小时。

### 监控指标

| 指标 | 阈值 | 触发动作 |
|------|------|----------|
| 错误率 | > 5% | 警告 |
| 错误率 | > 10% | 自动回滚 |
| 响应时间 | > 2x 基线 | 警告 |
| 响应时间 | > 5x 基线 | 自动回滚 |
| 资源使用 | > 150% 基线 | 警告 |

### 告警规则

```
IF 错误率 > 10% OR 响应时间 > 5x基线
THEN 自动回滚 + 通知 GM + 通知 Human
```

---

## 回滚机制

### 自动回滚触发条件
- 错误率超过 10%
- 响应时间超过基线 5 倍
- 检测到安全异常
- 资源使用异常

### 回滚流程
```
1. 停止使用改进内容
2. Git revert 变更
3. 通知所有审批者
4. 记录回滚原因
5. 更新提案状态
```

### 手动回滚
任何审批者都可以在监控窗口内手动触发回滚。

---

## 特殊情况处理

### 紧急改进
- 定义：修复安全漏洞或严重 bug
- 流程：GM + Human 双重审批（跳过前两级）
- 时限：4 小时

### 关键改进
- 定义：影响多个 agent 的改进
- 流程：所有受影响 agent 的 PM 都需要审批
- 时限：延长至 7 天

### 失败处理
- 分析失败原因
- 更新风险评估方法
- 改进测试流程
- 文档化教训

---

## 审计要求

所有自我改进必须记录：
- 完整的提案内容
- 所有审批者的意见
- 部署时间戳
- 监控期间的指标
- 最终状态（成功/回滚）
- 经验教训

---

## 模板位置

- 提案模板: `~/clawos/templates/improvement-proposal-template.md`
- 提案目录: `~/clawos/blackboard/proposals/self-improvement/`
- 审计日志: `~/clawos/blackboard/audit/extensions/`
