# Memory 免费层节流参数（Voyage 429 友好）

适用场景：Voyage 免费层（低 RPM / TPM）下，保证 memory 功能“能用且不炸”。

## 推荐参数（务实默认）

1. 查询频率
- 同一会话 `memory_search`：**最小间隔 25 秒**
- 全局 `memory_search`：**每分钟最多 2 次**

2. 检索规模
- `maxResults`：默认 **3**（不要一上来 10）
- 仅在需要时再 `memory_get` 拉上下文行

3. 缓存策略
- 相同 query 在 10 分钟内：优先复用上次结果
- 缓存 TTL：**600 秒**

4. 退化策略（429 时）
- 第1次429：等待 20 秒重试
- 第2次429：等待 40 秒重试
- 第3次429：停止实时检索，改用“最近一次缓存 + 明确提示用户已限流”

5. 触发策略
- 只有涉及“历史决策/偏好/待办/日期/人物”时才触发 memory_search
- 普通闲聊不触发 memory_search

## 执行口径（对话层）
- 先查一次 memory_search
- 命中后只读必要片段（memory_get）
- 低置信度时明确说“已检查但当前检索受限”

## 可复制模板

- memory_search:
  - query: 精准短句
  - maxResults: 3
- memory_get:
  - from: 命中行前后 20 行内
  - lines: 40 以内

## 目标
- 在免费层把 429 频率降到可接受
- 优先保证“稳定可答复”，再追求“最全召回”
