name: CI

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]
  workflow_dispatch:

jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Check file structure
        run: |
          echo "Checking ClawOS Brain structure..."
          ls -la
          test -f CLAUDE.md || { echo "Missing CLAUDE.md"; exit 1; }
          test -d code || { echo "Missing code/"; exit 1; }
          test -d brain || { echo "Missing brain/"; exit 1; }
          
      - name: Validate JSON files
        run: |
          echo "Validating JSON files..."
          find . -name "*.json" -type f | head -20 | while read f; do
            jq . "$f" > /dev/null 2>&1 || echo "Invalid JSON: $f"
          done

  sync-check:
    runs-on: ubuntu-latest
    needs: lint
    steps:
      - uses: actions/checkout@v4
      
      - name: Check sync status
        run: |
          echo "Repository: clawos-brain"
          echo "Branch: main"
          echo "Last commit: $(git log -1 --format='%h %s')"
